"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4517],{84517:function(e,t,s){s.d(t,{Z:function(){return q}});var n=s(85893),r=s(67091),a=s(54418),i=s(78001),o=s(73069),l=s(21805),c=s(21469),d=s(11163),m=s(67294),u=s(91173),x=s(23735),h=s(35377),p=s(78133),g=s(45830),v=s(8583),j=s(14323);let f=e=>{let{chatbot:t,isOwner:s,conversationId:a,showBotInfo:i,showSettings:o,setOpenSheet:c,setShowBotInfo:f,setMessages:w,setConversationId:b}=e,{asPath:y,push:k}=(0,d.useRouter)(),[N,C]=(0,m.useState)(!1),{isMobile:S}=(0,u.Z)(),{session:L}=(0,l.t)(),[M,B]=(0,m.useState)(!1),{userId:Z}=(0,r.Z)(),I=()=>{let e=t.defaultBotMessage&&t.defaultBotMessage.length>0?[{message:t.defaultBotMessage,sender:"bot"}]:[];w(e),b(void 0)};return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(p.Z,{content:(0,n.jsxs)("div",{className:"w-full rounded-md p-2",children:[(0,n.jsxs)("button",{onClick:async()=>{C(!1),f(!i)},className:(0,j.cn)("flex gap-2 w-full items-center justify-start space-x-2 rounded-md p-2 ","text-left text-sm transition-all duration-75",(0,j.uL)()),children:[(0,n.jsx)("div",{className:"flex items-center justify-center w-5 h-5",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})})}),i?"Hide":"Show"," Info"]}),S&&!y.startsWith("/embed")&&(0,n.jsxs)("button",{onClick:async()=>{await (0,j.$b)(t,L?L.id:void 0,()=>(0,v.Q)("Copied Link to clipboard!")),C(!1)},className:(0,j.cn)("flex gap-2 w-full items-center justify-start space-x-2 rounded-md p-2 ","text-left text-sm transition-all duration-75",(0,j.uL)()),children:[(0,n.jsx)("div",{className:"flex items-center justify-center w-5 h-5",children:(0,n.jsx)(x.vU,{size:"md"})})," ","Share Bot"]}),s&&(0,n.jsxs)("button",{onClick:()=>{k("/".concat(t.createdByUsername,"/").concat(t.slug,"/analytics")),C(!1)},className:(0,j.cn)("flex gap-2 w-full items-center justify-start space-x-2 rounded-md p-2 ","text-left text-sm transition-all duration-75",(0,j.uL)()),children:[(0,n.jsx)(x.n$,{}),"Analytics"]}),s&&o&&(0,n.jsxs)("button",{onClick:()=>{c(!0),C(!1)},className:(0,j.cn)("flex gap-2 w-full items-center justify-start space-x-2 rounded-md p-2 ","text-left text-sm transition-all duration-75",(0,j.uL)()),children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:[(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"}),(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})," ","Settings"]}),a&&Z&&(0,n.jsxs)("button",{onClick:async()=>{if(M)return;B(!0);let e=await g.x.clearConversationHistory({conversationId:a,userId:Z});e.ok?(I(),(0,v.Q)("Successfully cleared chat history.")):(0,v.J)("Could not clear chat history. Please try again later."),C(!1),B(!1)},className:(0,j.cn)("flex gap-2 w-full items-center justify-start space-x-2 rounded-md p-2 ","text-left text-sm transition-all duration-75",M&&"cursor-default",(0,j.uL)()),children:[M?(0,n.jsx)("div",{className:"w-5 flex items-center justify-center",children:(0,n.jsx)(h.Z,{small:!0})}):(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})}),"Clear Chat"]})]}),openPopover:N,setOpenPopover:C,children:(0,n.jsx)("button",{onClick:()=>C(!N),className:(0,j.cn)("select-none text-sm cursor-pointer flex items-center gap-1 px-2 py-1","rounded-md","transition duration-200 ease-in-out","text-xs",(0,j.uL)()),children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM12.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM18.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"})})})})})};var w=s(3436),b=s(86419);function y(e){let{children:t,content:s,align:r="center",openPopover:a,setOpenPopover:i,className:o}=e;return(0,n.jsxs)(b.fC,{open:a,onOpenChange:e=>{if(i)return i(e)},children:[(0,n.jsx)(b.xz,{asChild:!0,children:t}),(0,n.jsx)(b.VY,{sideOffset:4,align:r,className:(0,j.cn)("TooltipContent z-50 items-center overflow-hidden text-sm p-2","rounded-md border border-primary-700 bg-primary-900 p-1","shadow-md ",o),children:s})]})}let k=e=>{let t=()=>(0,n.jsxs)(c.E.button,{onClick:e.handler,className:(0,j.cn)("select-none text-sm cursor-pointer flex items-center gap-1 px-2 py-1","rounded-md","transition duration-200 ease-in-out","text-xs",(0,j.uL)()),whileTap:{scale:.97},children:[e.loading?(0,n.jsx)("div",{className:"flex items-center justify-center w-4",children:(0,n.jsx)(h.Z,{small:!0})}):e.icon," ",e.text&&(0,n.jsx)("span",{className:"hidden xl:block",children:e.text})]});return!e.openPopover&&e.isHovered?(0,n.jsx)("div",{className:"",children:(0,n.jsx)(w.Z,{content:e.tooltipMessage,className:"text-xs m-1",children:t()})}):(0,n.jsx)("div",{className:"",children:(0,n.jsx)(y,{content:e.popoverContent,className:"text-xs m-1",openPopover:e.openPopover,setOpenPopover:e.setOpenPopover,children:t()})})};var N=function(){let{time:e=2e3}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,s]=(0,m.useState)(!1),[n,r]=(0,m.useState)(""),a=t=>{t&&r(t),s(!0),setTimeout(()=>{s(!1),r("")},e)};return{isActive:t,triggerToggle:a,message:n}},C=s(6869);let S=e=>{let{chatbot:t}=e,[s,a]=(0,m.useState)(!1),[i,o]=(0,m.useState)(!1),{userId:l}=(0,r.Z)(),{isActive:c,message:d,triggerToggle:u}=N(),[h,p]=(0,C.Z)();(0,m.useEffect)(()=>{t.saved?a(!0):a(!1)},[t.saved]);let f=async()=>{if(!l){console.warn("skip API call to toggle favorited chatbot due undefined userId");return}if(o(!0),s){let e=await g.x.removeChatbotFromFavorites({userId:l,id:t.id});e.ok?(a(!1),u("Removed Save")):(0,v.J)("Something went wrong.")}else{let e=await g.x.addChatbotToFavorites({userId:l,id:t.id});e.ok?(a(!0),u("Saved")):(0,v.J)("Something went wrong.")}o(!1)};return l?(0,n.jsx)("div",{ref:h,children:(0,n.jsx)(k,{loading:i,handler:f,openPopover:c,tooltipMessage:s?"Remove save":"Save",isHovered:p,icon:s?(0,n.jsx)(x.GK,{size:"sm",className:"fill-yellow-300",pathClassName:"stroke-1 stroke-black "}):(0,n.jsx)(x.GK,{size:"sm",className:(0,j.cn)(p?"fill-yellow-300":"fill-none"),pathClassName:(0,j.cn)("stroke-1 dark:stroke-primary-0")}),popoverContent:(0,n.jsxs)("div",{className:"flex gap-1",children:[(0,n.jsx)(x.NO,{size:"sm",color:"green",strokeWidth:2}),d]})})}):(0,n.jsx)(n.Fragment,{})};var L=s(41664),M=s.n(L);let B=e=>{let{chatbot:t}=e,[s,r]=(0,m.useState)(!1),{session:a}=(0,l.t)(),[i,o]=(0,C.Z)(),{isActive:c,message:d,triggerToggle:u}=N(),h=async()=>{r(!0),await (0,j.$b)(t,a?a.id:void 0,()=>{u("Link copied")}),r(!1)};return(0,n.jsx)("div",{ref:i,children:(0,n.jsx)(k,{loading:s,handler:h,openPopover:c,tooltipMessage:"Copy link",isHovered:o,icon:(0,n.jsx)(x.vU,{size:"sm"}),popoverContent:(0,n.jsxs)("div",{className:"flex gap-1",children:[(0,n.jsx)(x.NO,{size:"sm",color:"green",strokeWidth:2}),d]})})})};var Z=s(44781);let I=e=>{let{chatbot:t}=e;return(0,n.jsx)(M(),{href:(0,j.cb)({id:t.id,username:t.createdByUsername,slug:t.slug}),children:(0,n.jsx)(c.E.button,{onClick:async()=>{},className:(0,j.cn)("select-none text-sm cursor-pointer flex items-center gap-1 px-2 py-1","rounded-md","transition duration-200 ease-in-out","text-xs",(0,j.uL)()),whileTap:{scale:.97},children:(0,n.jsx)(x.qp,{size:"sm"})})})};var O=s(96093),z=s(51526),P=s(95591),W=s(814),E=function(e){let[t,s]=(0,m.useState)(0);return(0,m.useEffect)(()=>{let t=new ResizeObserver(e=>{if(!e.length)return;let t=e[0];s(t.contentRect.width)});return e&&"current"in e&&e.current&&t.observe(e.current),()=>{e&&"current"in e&&e.current&&t.unobserve(e.current)}},[e]),t},R=s(75080),F=s(20220),H=s(42889),T=s(24831);let U=e=>{let{chatbot:t,conversationId:s,setConversationId:a,setMessages:i,showBotInfo:o,session:l,setShowBotInfo:h}=e,{isSubscribed:p}=(0,Z.O)(),{asPath:v}=(0,d.useRouter)(),{isDesktop:b}=(0,u.Z)(),{isSignedIn:y,userId:k}=(0,r.Z)(),[N,C]=(0,m.useState)(!1),{isMobile:L}=(0,u.Z)(),O=(0,m.useRef)(null),R=E(O),F=(0,m.useMemo)(()=>!!k,[k]),{data:U}=(0,P.ZP)(F?g.x.url("listBuckets",{userId:k,chatbotId:t.id}):null,(0,W.SK)(W.k7,"connected bucket")),K=(0,m.useMemo)(()=>t.isOwner,[l&&l.id]),Y=(0,m.useMemo)(()=>v.startsWith("/embed"),[v]),_=(0,m.useMemo)(()=>v.startsWith("/dashboard"),[v]),q=(0,m.useMemo)(()=>t.createdByUsername&&!Y,[t.createdByUsername,Y]);return(0,n.jsxs)("div",{ref:O,className:(0,j.cn)("p-2 group bg-white dark:bg-primary-900","border-b border-border-light dark:border-border-dark"),children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"flex flex-grow items-center gap-2 cursor-pointer",onClick:()=>h(!o),children:[(0,n.jsx)("div",{className:"font-medium line-clamp-1 text-xl leading-7",children:t.name}),!Y&&(0,n.jsxs)(n.Fragment,{children:[" ",(0,n.jsx)("div",{className:(0,j.cn)("text-primary-500 rounded-full p-1 cursor-pointer","transition ease-in-out duration-200 active:bg-[rgba(0,0,0,0.06)] dark:active:bg-primary-700 hover:bg-[rgba(0,0,0,0.04)] dark:hover:bg-[rgba(255,255,255,0.06)] "),children:(0,H.$O)(t)&&(0,n.jsx)(T.Z,{small:!0})})]}),(0,n.jsx)("div",{className:"pt-1 group-hover:opacity-100 opacity-0 transition duration-200 ease-in-out",children:(0,n.jsx)(c.E.svg,{animate:{rotate:o?180:0},xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:3,stroke:"currentColor",className:"w-3 h-3 ",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 8.25l-7.5 7.5-7.5-7.5"})})})]}),!Y&&(0,n.jsxs)("div",{className:"flex gap-0 items-center justify-end",children:[!Y&&(0,n.jsx)(V,{isOwner:K,isService:t.isService,isSubscribed:p,embedHref:"/".concat(t.createdByUsername,"/").concat(t.slug,"/settings/integrate")}),y&&(0,n.jsx)(S,{chatbot:t}),b&&(0,n.jsx)(B,{chatbot:t}),_&&(0,n.jsx)(w.Z,{content:"Open in full page",className:"text-xs",children:(0,n.jsx)("div",{className:"md:block hidden",children:(0,n.jsx)(I,{chatbot:t})})}),R>400&&(0,n.jsx)(w.Z,{content:"Settings",className:"text-xs",children:(0,n.jsx)("div",{className:"md:block hidden",children:(0,n.jsx)(c.E.button,{onClick:()=>{C(!0)},className:(0,j.cn)("select-none text-sm cursor-pointer flex items-center gap-1 px-2 py-1","rounded-md","transition duration-200 ease-in-out","text-xs",(0,j.uL)()),whileTap:{scale:.97},children:(0,n.jsx)(x.iC,{size:"sm"})})})}),(0,n.jsx)(f,{chatbot:t,conversationId:s,isOwner:null!=K&&K,showBotInfo:o,showSettings:L||R<=400,setOpenSheet:C,setShowBotInfo:h,setMessages:i,setConversationId:a}),t&&(0,n.jsx)($,{openSheet:N,setOpenSheet:C,chatbot:t})]})]}),(0,n.jsx)(z.M,{children:o&&(0,n.jsxs)(c.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{type:"tween",duration:.2},className:(0,j.cn)("flex-grow","text-sm text-primary-300"),children:[(0,n.jsxs)("div",{className:"flex gap-x-2 items-center font-medium",children:[q&&(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z"})}),(0,n.jsx)(M(),{href:"/profile/".concat(t.createdByUsername),children:(0,n.jsx)("div",{className:"hover:text-primary-0 line-clamp-1 transition-all duration-200 ease-in-out",children:t.createdByUsername})})]})}),R>=400&&(0,n.jsxs)(n.Fragment,{children:[q&&(0,n.jsx)("div",{className:"rounded-full h-1 w-1 bg-primary-500"}),(0,n.jsx)(A,{chatbot:t})]}),U&&R>=650&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"rounded-full h-1 w-1 bg-primary-500"}),(0,n.jsx)(D,{connectedBucket:U,isOwner:K})]})]}),R<400&&(0,n.jsx)(A,{chatbot:t}),U&&R<650&&(0,n.jsx)(D,{connectedBucket:U,isOwner:K}),t.description&&(0,n.jsx)("div",{className:" text-justify line-clamp-5",children:t.description})]})})]})},V=e=>{let{isOwner:t,isService:s,isSubscribed:r,embedHref:a}=e;return(0,n.jsxs)(n.Fragment,{children:[t&&s&&!r&&(0,n.jsx)(M(),{href:"/pricing",children:(0,n.jsx)("div",{className:(0,j.cn)("h-8 select-none text-sm cursor-pointer flex items-center gap-2 px-3 py-1","rounded-xl transition duration-200 ease-in-out bg-orange-600 hover:bg-orange-700 active:bg-orange-800 text-white"),children:"Convert to premium and embed into your website"})}),t&&s&&r&&(0,n.jsx)(M(),{href:a,children:(0,n.jsx)("div",{className:(0,j.cn)("h-8 select-none text-sm cursor-pointer flex items-center gap-2 px-3 py-1","rounded-xl transition duration-200 ease-in-out bg-orange-600 hover:bg-orange-700 text-white"),children:"Embed into your website"})})]})},A=e=>{let{chatbot:t}=e;return(0,n.jsxs)("div",{className:"flex items-center gap-1 text-primary-300 font-medium",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"})}),(0,O.J5)(t)]})},D=e=>{let{connectedBucket:t,isOwner:s}=e;return(0,n.jsxs)("div",{className:"flex items-center gap-1 text-primary-300 font-medium",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"})}),s?(0,n.jsxs)(n.Fragment,{children:[" ","Connected to"," ",(0,n.jsx)(M(),{href:"/data/".concat(t.id),children:(0,n.jsx)("div",{className:" hover:text-primary-0 line-clamp-1 transition-all duration-200 ease-in-out",children:t.name})})]}):(0,n.jsx)(n.Fragment,{children:"Connected to Knowledge Base"})]})},$=e=>{let{openSheet:t,setOpenSheet:s,chatbot:r}=e,[a,i]=(0,C.Z)(),[o,l]=(0,C.Z)(),{push:c}=(0,d.useRouter)();return(0,n.jsx)(R.yo,{open:t,onOpenChange:e=>s(e),children:(0,n.jsxs)(R.ue,{side:"right",className:"sm:max-w-[50rem] w-full bg-primary-900 overflow-y-auto",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1 pb-4",children:[(0,n.jsx)("button",{onClick:()=>{s(!1)},className:(0,j.cn)("select-none text-sm cursor-pointer flex items-center gap-1 px-2 py-1","rounded-md","transition duration-200 ease-in-out","text-xs",(0,j.uL)()),children:(0,n.jsx)(x.VG,{size:"sm"})}),(0,n.jsx)("button",{className:(0,j.cn)("select-none text-sm cursor-pointer flex items-center gap-1 px-2 py-1","rounded-md","transition duration-200 ease-in-out","text-xs",(0,j.uL)()),onClick:()=>{c("/".concat(r.createdByUsername,"/").concat(r.slug,"/settings"))},children:(0,n.jsx)(x.qp,{size:"sm"})})]}),(0,n.jsx)(F.Z,{type:"popup",chatbot:r,closePopup:()=>s(!1)})]})})};var K=s(66587),Y=s(9954);let _=e=>{var t;let{chatbot:s}=e,[u,x]=(0,m.useState)(!0),[p,g]=(0,m.useState)([]),[v,j]=(0,m.useState)(!1),{session:f}=(0,l.t)(),{userId:w}=(0,r.Z)(),[b,y]=(0,m.useState)(0),[k,N]=(0,m.useState)(!1),[C,S]=(0,m.useState)(!1),[L,M]=(0,m.useState)(!1),B=(0,d.useRouter)(),[Z,I]=(0,m.useState)(),[O,z]=(0,m.useState)(!1),{ALLOW_IMAGE_GEN:P}=(0,a.Z)();(0,m.useEffect)(()=>{f&&W(f)},[f&&f.authenticated]);let W=async e=>{if(0!==b&&y(0),N(!1),e.authenticated){let t=await (0,i.Rr)({chatbotId:s.id,userId:e.id,limit:20});t.conversationId&&I(t.conversationId),t.messages?((0,i.S9)(g,i.Km.HISTORY,{messages:t.messages}),y(e=>e+1)):s.defaultBotMessage&&R(s.defaultBotMessage),E(t.messages),t.messages&&t.messages.length<40&&N(!0)}else s.defaultBotMessage&&R(s.defaultBotMessage);x(!1)},E=e=>{let t=s.defaultBotMessage?1:0;e&&e.length>t&&M(!0)},R=e=>{(0,i.S9)(g,i.Km.HISTORY,{messages:[{message:e,sender:"bot"}]})},F=async e=>{if(!f||!e)return;j(!0),(0,i.S9)(g,i.Km.USER_INPUT,{message:e});let t={setMessages:g,setConversationId:I,chatbot:s,conversationId:Z,uid:f.id,input:e};P&&e&&e.length>0&&e.toLowerCase().startsWith(i.Y)?await (0,i.Px)({...t}):await (0,i.KO)({...t}),j(!1)};return(0,n.jsxs)(c.E.div,{variants:o._W,initial:"hidden",animate:"show",className:"".concat("/"===B.asPath?"px-4 pb-4 pt-2":""," flex-grow flex flex-col h-full rounded relative"),children:[(0,n.jsx)(U,{chatbot:s,conversationId:Z,setConversationId:I,setMessages:g,session:f,showBotInfo:O,setShowBotInfo:z}),(0,n.jsx)(Y.Z,{isTyping:v,messages:p,emoji:null!==(t=s.emoji)&&void 0!==t?t:void 0,scrollIntoView:b<=1,showInfo:O,conversationId:Z,loadMoreMessages:(0,n.jsx)(n.Fragment,{children:!u&&L&&p.length>=20&&(0,n.jsx)("div",{className:"flex items-center justify-center text-sm",children:k?(0,n.jsx)("div",{children:"This is the beginning of your chat history"}):(0,n.jsxs)("button",{disabled:C,className:"flex items-center gap-2 bg-primary-800 py-1 px-2 rounded-lg",onClick:async()=>{if(!f)return;S(!0);let e=await (0,i.Rr)({chatbotId:s.id,userId:f.id,limit:20,offset:20*b});if(e&&e.messages){let t=function(e,t){var s,n;let r={};for(let t in e){let n=e[t],a=null!==(s=null==n?void 0:n.conversationItemId)&&void 0!==s?s:t;r[a]||(r[a]=[]),r[a].push(n)}for(let e in t){let s=t[e],a=null!==(n=null==s?void 0:s.conversationItemId)&&void 0!==n?n:e;r[a]||(r[a]=[]),r[a].push(s)}let a=[];for(let e in r){let t=r[e];t.sort((e,t)=>void 0===e.timestamp&&void 0!==t.timestamp?-1:void 0!==e.timestamp&&void 0===t.timestamp?1:e.sender!==t.sender?"user"===e.sender?-1:1:void 0!==e.timestamp&&void 0!==t.timestamp?e.timestamp-t.timestamp:0),a.push(...t)}return a}(e.messages,p);g(t),y(e=>e+1)}else e&&N(!0);S(!1)},children:[C&&(0,n.jsx)(h.Z,{small:!0}),"Load More"]})})})}),(0,n.jsx)(K.ZP,{chatbot:s,handleSendMessage:F,inputBlocker:u?{type:"loadingHistory"}:s.deleted?{type:"deleted",message:"This chatbot has been deleted by the creator. New messages cannot be sent."}:v?{type:"typing"}:{type:"none"},hasNoHistory:!p||0===p.length,shareConversationProps:!s.isService&&!B.asPath.startsWith("/embed")&&!v&&p.length>0&&Z&&w?{userId:w,conversationId:Z,messages:p}:void 0})]})};var q=_},42889:function(e,t,s){s.d(t,{ZP:function(){return w},$O:function(){return y}});var n=s(85893),r=s(67294),a=s(21469),i=s(73069),o=s(14323),l=s(94772),c=s(8275),d=s(20220),m=s(3436);let u=e=>{let{chatbot:t,openDialog:s,setOpenDialog:r,className:i,mutate:l,...u}=e;return(0,n.jsxs)(c.Vq,{open:s,onOpenChange:e=>r(e),children:[(0,n.jsx)("div",{className:"flex items-center justify-center ",children:(0,n.jsx)(c.hg,{className:(0,o.cn)(i),children:(0,n.jsx)(a.E.div,{whileTap:{scale:.95},className:"flex items-center",onClick:u.onClick,children:(0,n.jsx)(m.Z,{content:"Settings",children:(0,n.jsx)("div",{className:(0,o.cn)("p-1 text-gray-700 dark:text-gray-400 hover:text-primary-300 font-bold text-xs rounded-full transition duration-200 ease-in-out",(0,o.uL)()),children:(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:[(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"}),(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})})})})}),(0,n.jsxs)(c.cZ,{className:(0,o.cn)("bg-primary-900","border-none max-w-[90%] md:max-w-[80%] lg:max-w-[70%] xl:max-w-[60%] w-full max-h-[90%] h-full overflow-auto"),children:[(0,n.jsx)(c.$N,{className:"text-xl",children:"Chatbot Settings"}),(0,n.jsx)(d.Z,{type:"popup",chatbot:t,mutate:l,closePopup:()=>r(!1)})]})]})};var x=s(51575);let h=e=>{let{visibility:t}=e,[s,a]=(0,r.useState)(!1),{icon:i,label:o,description:l}=(0,r.useMemo)(()=>x.z[t],[t]);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)(p,{visibilityInfo:{icon:i,label:o,description:l},openDialog:s,setOpenDialog:a,children:(0,n.jsx)(m.Z,{content:o,delayDuration:50,children:i})})})})},p=e=>{let{visibilityInfo:t,openDialog:s,setOpenDialog:r,className:a,children:i}=e;return(0,n.jsxs)(c.Vq,{open:s,onOpenChange:e=>r(e),children:[(0,n.jsx)("div",{className:"flex items-center justify-center ",children:(0,n.jsx)(c.hg,{className:(0,o.cn)(a),children:i})}),(0,n.jsxs)(c.cZ,{className:(0,o.cn)("max-w-[400px] w-[95%] md:w-full p-4 max-h-[90%] overflow-auto"),children:[(0,n.jsxs)(c.$N,{className:"text-xl flex gap-2 items-center",children:[t.label,t.icon]}),(0,n.jsx)(c.DR,{className:(0,o.cn)("text-primary-300","flex gap-2 flex-grow"),children:t.description})]})]})};var g=s(94804),v=s(24831),j=s(27023);let f=e=>{var t,s,c;let{version:d="expanded",chatbot:m,onChatbotClick:x,setSelectedChatbotId:p,selectedChatbotId:g,mutate:f,hideIcons:w=!1,minimal:k=!1}=e,[N,C]=(0,r.useState)(!1),S=(0,r.useRef)(null),L=(0,r.useRef)(null);return(0,n.jsxs)(a.E.div,{ref:L,variants:i.sE,className:"flex items-center w-full gap-2 group/item",children:[(0,n.jsx)("div",{onClick:e=>{var t,s;(null===(t=S.current)||void 0===t?void 0:t.contains(e.target))?e.preventDefault():(null===(s=L.current)||void 0===s?void 0:s.contains(e.target))&&(null==p||p(m.id),null==x||x(m.id))},className:(0,o.cn)("flex-grow truncate","flex flex-col","rounded-lg ",k?"px-2 py-1":"p-2","transition duration-200 ease-in-out relative group","cursor-pointer",(0,o.uL)(g===m.id)),children:"minimized"===d?(0,n.jsx)("div",{className:"text-xl flex items-center justify-center",children:null!==(t=m.emoji)&&void 0!==t?t:l.$Y}):(0,n.jsxs)("div",{className:(0,o.cn)("flex-grow truncate flex items-center gap-2 overflow-x-hidden cursor-pointer"),children:[(0,n.jsx)("div",{className:"text-xl",children:null!==(s=m.emoji)&&void 0!==s?s:l.$Y}),(0,n.jsx)("div",{className:"w-full flex flex-row truncate",children:(0,n.jsxs)("div",{className:"group-hover:text-primary-0 font-medium line-clamp-1 transition ease-in-out duration-200 flex flex-row items-center gap-1 w-full",children:[(0,n.jsx)("span",{children:null!==(c=m.name)&&void 0!==c?c:"My Chatbot"}),(0,n.jsx)("div",{className:(0,o.cn)("text-primary-500 rounded-full p-1 cursor-pointer","transition ease-in-out duration-200 active:bg-[rgba(0,0,0,0.06)] dark:active:bg-primary-700 hover:bg-[rgba(0,0,0,0.04)] dark:hover:bg-[rgba(255,255,255,0.06)] "),children:y(m)&&(0,n.jsx)(v.Z,{small:!0})})]})})]})}),"expanded"===d&&!w&&(0,n.jsxs)("div",{ref:S,className:(0,o.cn)("group-hover/item:opacity-100 opacity-0","group-hover/item:w-12 w-0","flex items-center justify-end  overflow-x-hidden"),children:[m.isService&&(0,n.jsx)(b,{}),(0,n.jsx)("div",{className:(0,o.cn)("text-gray-700 dark:text-gray-400 rounded-full p-1 cursor-pointer","transition ease-in-out duration-200 active:bg-[rgba(0,0,0,0.06)] dark:active:bg-primary-700 hover:bg-[rgba(0,0,0,0.04)] dark:hover:bg-[rgba(255,255,255,0.06)] "),children:m.isOwner?(0,n.jsx)(h,{visibility:m.visibility}):m.boosted&&(0,n.jsx)(j.Z,{small:!0,withDialog:!0})}),m.isOwner&&(0,n.jsx)(u,{mutate:f,chatbot:m,openDialog:N,setOpenDialog:C})]})]})};var w=f;let b=()=>(0,n.jsx)(m.Z,{content:"Lead Generation Bot",delayDuration:500,children:(0,n.jsx)("div",{className:"text-xs text-orange-600 line-clamp-1 p-1",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25m16.5 0a2.18 2.18 0 00.75-1.661V8.706c0-1.081-.768-2.015-1.837-2.175a48.114 48.114 0 00-3.413-.387m4.5 8.006c-.194.165-.42.295-.673.38A23.978 23.978 0 0112 15.75c-2.648 0-5.195-.429-7.577-1.22a2.016 2.016 0 01-.673-.38m0 0A2.18 2.18 0 013 12.489V8.706c0-1.081.768-2.015 1.837-2.175a48.111 48.111 0 013.413-.387m7.5 0V5.25A2.25 2.25 0 0013.5 3h-3a2.25 2.25 0 00-2.25 2.25v.894m7.5 0a48.667 48.667 0 00-7.5 0M12 12.75h.008v.008H12v-.008z"})})})}),y=e=>e.config&&e.config.data.model!==g.Ef}}]);